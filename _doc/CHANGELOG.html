<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta name="theme-color" content="#375EAB">
		<meta name="author" content="Shulhan">
		<meta name="generator" content="asciidoctor-go 0.3.0">
		<title>CHANGELOG</title>
		<style>
body {
	margin: 0;
	font-family: Arial, sans-serif;
	background-color: #fff;
	line-height: 1.3;
	text-align: center;
	color: #222;
}
pre,
code {
	font-family: Menlo, monospace;
	font-size: 0.875rem;
}
pre {
	line-height: 1.4;
	overflow-x: auto;
	background: #efefef;
	padding: 0.625rem;
	border-radius: 0.3125rem;
}
a {
	color: #007d9c;
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}

p,
li {
	max-width: 50rem;
	word-wrap: break-word;
}
li p {
	margin: 2px;
}
p,
pre,
ul,
ol {
	margin: 1.25rem;
}

h1,
h2,
h3,
h4 {
	margin: 1.25rem 0 1.25rem;
	padding: 0;
	color: #007d9c;
	font-weight: bold;
}
h1 {
	font-size: 1.75rem;
	line-height: 1;
}
h1 .text-muted {
	color: #777;
}
h2 {
	clear: right;
	font-size: 1.25rem;
	background: #e0ebf5;
	padding: 0.5rem;
	line-height: 1.25;
	font-weight: normal;
	overflow: auto;
	overflow-wrap: break-word;
}
h2 a {
	font-weight: bold;
}
h3 {
	font-size: 1.25rem;
	line-height: 1.25;
	overflow: auto;
	overflow-wrap: break-word;
}
h3,
h4 {
	margin: 1.25rem 0.3125rem;
}
h4 {
	font-size: 1rem;
}

h2 > span,
h3 > span {
	float: right;
	margin: 0 25px 0 0;
	font-weight: normal;
	color: #5279c7;
}

dl {
	margin: 1.25rem;
}
dt {
	font-weight: bold
}
dd {
	margin: 0 0 0 1.25rem;
}

/**
 * Custom classes for pages
 */

.admonitionblock > table {
	border-collapse: separate;
	border: 0;
	background: none;
	width: 100%;
}
.admonitionblock > table td.icon {
	text-align: center;
	width: 120px;
}
.admonitionblock > table td.icon img {
	max-width: none;
}
.admonitionblock > table td.icon .title {
	font-weight: bold;
	font-family: "Open Sans","DejaVu Sans",sans-serif;
	text-transform: uppercase;
}
.admonitionblock > table td.content {
	padding-left: 1.125em;
	padding-right: 1.25em;
	border-left: 1px solid #dddddf;
	word-wrap: anywhere;
}
.admonitionblock > table td.content>:last-child>:last-child {
	margin-bottom: 0;
}
.admonitionblock.note td.icon {
	background-color: whitesmoke;
}
.admonitionblock.tip td.icon {
	background-color: azure;
}
.admonitionblock.important td.icon {
	background-color: honeydew;
}
.admonitionblock.caution td.icon {
	background-color: lavenderbush;
}
.admonitionblock.warning td.icon {
	background-color: mistyrose;
}

.topbar {
	background: #e0ebf5;
	height: 4rem;
	overflow: hidden;
}

.topbar .top-heading,
.topbar .menu {
	padding: 1.313rem 0;
	font-size: 1.25rem;
	font-weight: normal;
}
.topbar .top-heading {
	float: left;
}
.topbar .top-heading a {
	color: #222;
	text-decoration: none;
}

.top-heading .header-logo {
	height: 2rem;
	width: 5.125rem;
}

.topbar .menu {
	float: right;
}
.topbar .menu a {
	margin: 0.625rem 0.125rem;
	padding: 0.625rem;
	color: white;
	background: #007d9c;
	border: 0.0625rem solid #007d9c;
	border-radius: 5px;
}
.topbar .menu form {
	display: inline-block;
}

.page {
	width: 100%;
}

.page > .container,
.topbar > .container,
.footer > .container {
	margin-left: auto;
	margin-right: auto;
	padding: 0 1.25rem;
	max-width: 59.38rem;
}

.page > .container {
	text-align: left;
}

.container .meta {
	font-style: italic;
	margin: 1.25rem;
}

.footer {
	text-align: center;
	color: #666;
	font-size: 0.875rem;
	margin: 2.5rem 0;
}

.ulist li .paragraph {
	margin-bottom: 1em;
}

.ulist li .paragraph {
	margin-bottom: 1em;
}

/** Custom classes */
#toctitle {
	display: none;
}
#toc li {
	list-style: none;
}
#toc ul .sectlevel1 {
	padding: 0px;
	margin: 4px;
}
#toc ul .sectlevel2 {
	margin: 4px;
}

@media screen and (max-width: 992px) {
	#toc {
		all: unset;
	}
}
</style>
	</head>
	<body>
		<div class="topbar">
			<div class="container">
				<div class="top-heading">
					<a href="/">CHANGELOG</a>
				</div>
				<div class="menu">
					<form class="item" action="/_internal/search">
						<input type="text" name="q" placeholder="Search" />
					</form>
				</div>
			</div>
		</div>

		<div class="page">
			<div class="container">
<div id="header">
<h1>CHANGELOG</h1>
<div class="details">
<span id="author" class="author">Shulhan</span><br>
<span id="email" class="email"><a href="mailto:ms@kilabit.info">ms@kilabit.info</a></span><br>
<span id="revdate">3 July 2022</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#v0_40_0">share v0.40.0 (2022-08-05)</a>
<ul class="sectlevel2">
<li><a href="#v0_40_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_40_0_new_features">New features</a></li>
<li><a href="#v0_40_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_40_0_enhancements">Enhancements</a></li>
</ul>
</li>
<li><a href="#v0_39_0">share v0.39.0 (2022-07-03)</a>
<ul class="sectlevel2">
<li><a href="#v0_39_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_39_0_new_features">New features</a></li>
<li><a href="#v0_39_0_enhancements">Enhancements</a></li>
</ul>
</li>
<li><a href="#v0_38_0">share v0.38.0 (2022-06-05)</a>
<ul class="sectlevel2">
<li><a href="#breaking_changes">Breaking changes</a></li>
<li><a href="#v0_38_0_enhancements">Enhancements</a></li>
<li><a href="#v0_38_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_37_0">share v0.37.0 (2022-05-09)</a>
<ul class="sectlevel2">
<li><a href="#v0_37_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_37_0_new_features">New features</a></li>
<li><a href="#v0_37_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_37_0_enhancements">Enhancements</a></li>
<li><a href="#v0_37_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_36_0">share v0.36.0 (2022-04-03)</a>
<ul class="sectlevel2">
<li><a href="#v0_36_0_breaking_changes">Breaking changes</a></li>
<li><a href="#new_features">New features</a></li>
<li><a href="#enhancements">Enhancements</a></li>
<li><a href="#bug_fixes">Bug fixes</a></li>
<li><a href="#chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_35_0">share v0.35.0 (2022-03-04)</a>
<ul class="sectlevel2">
<li><a href="#v0_35_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_35_0_new_features">New features</a></li>
<li><a href="#v0_35_0_enhancements">Enhancements</a></li>
<li><a href="#v0_35_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_35_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_34_0">share v0.34.0 (2022-02-05)</a>
<ul class="sectlevel2">
<li><a href="#v0_34_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_34_0_new_features">New features</a></li>
<li><a href="#v0_34_0_enhancements">Enhancements</a></li>
<li><a href="#v0_34_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_33_0">share v0.33.0 (2022-01-09)</a>
<ul class="sectlevel2">
<li><a href="#v0_33_0_new_features">New features</a></li>
<li><a href="#v0_33_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_33_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_33_0_enhancements">Enhancements</a></li>
<li><a href="#v0_33_0_chores">Chores</a></li>
</ul>
</li>
</ul>

</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This library is released every month, usually at the first week of month.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2021.html" target="_blank" rel="noopener">Changelog in 2021</a>.
This is changelog for share module since v0.22.0 until v0.32.0.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2020.html" target="_blank" rel="noopener">Changelog in 2020</a>.
This is changelog for share module since v0.12.0 until v0.21.0.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2018-2019.html" target="_blank" rel="noopener">Changelog from 2018 to 2019</a>.
This is changelog for share module since v0.1.0 until v0.11.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_40_0"><a class="anchor" href="#v0_40_0"></a><a class="link" href="#v0_40_0">share v0.40.0 (2022-08-05)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_40_0_breaking_changes"><a class="anchor" href="#v0_40_0_breaking_changes"></a><a class="link" href="#v0_40_0_breaking_changes">Breaking changes</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">lib/memfs: set the Root SysPath to the first MemFS instance on Merge</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, calling Merge(&#8230;&#8203;), set the merged MemFS Root.SysPath to
"..".
Since we allow the TryDirect to access the file directly (if its set
to true), this may cause the file system leaks if returned MemFS set
this flag to true.</p>
</div>
<div class="paragraph">
<p>To prevent that, we set the SysPath to the first MemFS SysPath.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/memfs: rename Option field Development to TryDirect</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This changes the usage of Development flag.</p>
</div>
<div class="paragraph">
<p>TryDirect define a flag to bypass file in memory.
If its true, any call to Get will try direct read to file system.</p>
</div>
<div class="paragraph">
<p>This flag has several use cases.
First, to test serving file system directly from disk during
development.
Second, to combine embedded MemFS instance with non-embedded instance.
One is reading content from memory, one is reading content from disk
directly.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="v0_40_0_new_features"><a class="anchor" href="#v0_40_0_new_features"></a><a class="link" href="#v0_40_0_new_features">New features</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">_bin: add script to run Go benchmark</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The go-bench.sh accept two arguments: the method or function to benchmark,
default to "."; and benchmark number, default to current timestamp
YYYYmmDD-HHMM.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">_bin: add script to run Go test and generate HTML coverage</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The script accept one single argument: the path to package to
be tested.
If its empty default to current directory and sub-directories.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">_bin: add script go-mod-tip.sh</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The go-mod-tip shell script get and print the latest Go module
version based on the last tag and the latest commit hash from the
current working directory.</p>
</div>
<div class="paragraph">
<p>This command usually used to fix go.mod due to force commit.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">cmd/epoch: print the weekday in local and UTC time</dt>
<dd>
</dd>
<dt class="hdlist1">cmd/epoch: add flag to parse time from RFC3339 and RFC1123 format</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The flag for RFC1123 comes with two options one with string timezone
(-rfc1123) and one with numeric time zone (-rfc1123z).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">cmd/ini: a CLI to get and set values in the INI file format</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>This is the CLI that implements the lib/ini for getting and setting
the key&#8217;s value from INI file.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/test: implement Data, a type to load formatted file for helping test</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Data contains predefined input and output values that is loaded from
file to be used during test.</p>
</div>
<div class="paragraph">
<p>The data provides zero or more flags, an optional description, zero or
more input, and zero or more output.</p>
</div>
<div class="paragraph">
<p>The data file name must end with ".txt".</p>
</div>
<div class="paragraph">
<p>The data content use the following format,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[FLAG_KEY ":" FLAG_VALUE LF]
[LF DESCRIPTION]
LF
"&gt;&gt;&gt;" [INPUT_NAME] LF
INPUT_CONTENT
LF
"&lt;&lt;&lt;" [OUTPUT_NAME] LF
OUTPUT_CONTENT</pre>
</div>
</div>
<div class="paragraph">
<p>The data can contains zero or more flag.
A flag is key and value separated by ":".
The flag key must not contain spaces.</p>
</div>
<div class="paragraph">
<p>The data may contain description.</p>
</div>
<div class="paragraph">
<p>The line that start with "\n&gt;&gt;&gt;" defined the beginning of input.
An input can have a name, if its empty it will be set to "default".
An input can be defined multiple times, with different names.</p>
</div>
<div class="paragraph">
<p>The line that start with "\n&lt;&lt;&lt;" defined the beginning of output.
An output can have a name, if its empty it will be set to "default".
An output also can be defined multiple times, with different names.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="v0_40_0_bug_fixes"><a class="anchor" href="#v0_40_0_bug_fixes"></a><a class="link" href="#v0_40_0_bug_fixes">Bug fixes</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">lib/ini: fix parsing and saving multi line variables</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, if INI file contains multi line variables, for example</p>
</div>
<div class="literalblock">
<div class="content">
<pre>key = a \
b</pre>
</div>
</div>
<div class="paragraph">
<p>The Get and saved value is "a \tb", where it should be "a b" for Get and
"a \\\n\t\b" again when saved.</p>
</div>
<div class="paragraph">
<p>This changes require refactoring how the variable&#8217;s value is parsed and
stored.
A variable value is parsed and stored from character after "=" until new
line or comment as raw value, and the real value is derived by trimming
white spaces, handle escaped character and double quotes.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/ini: fix marshaling pointer to nil field</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the field is pointer, the code will thrown panic if its point to
nil struct or print "&lt;invalid reflct.Value&gt;" for String.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/memfs: ignore error on Get when calling node Update</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If node exist in memory, error on Update does not means the file is not
exist.
The node may have been embedded and then merged with other MemFS instance
with Development flag set to true.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="v0_40_0_enhancements"><a class="anchor" href="#v0_40_0_enhancements"></a><a class="link" href="#v0_40_0_enhancements">Enhancements</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">lib/dns: add field SOA to the ServerOptions</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The SOA field defined the root authority for all zones and records
served under the Server.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/http: add server options to generate index.html automatically</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the EnableIndexHtml in the ServeOptions enabled, server generate
list of files inside the requested path as HTML.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/ini: support escaped double-quote and colon in tag subsection</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>A colon <code>:</code> is escaped using double backslash <code>\\</code>, for example
<code>a:b\\:c:d</code> contains section <code>a</code>, subsection <code>b:c</code>, and variable <code>d</code>.</p>
</div>
<div class="paragraph">
<p>A double quote <code>"</code> is escaped using triple backslash, for example
(<code>\\\"</code>).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/ini: handle marshaling slice of time.Time</dt>
<dd>
<p>-</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_39_0"><a class="anchor" href="#v0_39_0"></a><a class="link" href="#v0_39_0">share v0.39.0 (2022-07-03)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_39_0_breaking_changes"><a class="anchor" href="#v0_39_0_breaking_changes"></a><a class="link" href="#v0_39_0_breaking_changes">Breaking changes</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">all: move lib/sanitize.HTML to net/html.Sanitize</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Since the sanitize package only contains HTML function, and the html
package already exist, we move the function into html package.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="v0_39_0_new_features"><a class="anchor" href="#v0_39_0_new_features"></a><a class="link" href="#v0_39_0_new_features">New features</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">lib/mlog: add method Close to MultiLogger</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Close method flush and close all log forwarders.
Any write to a closed MultiLogger will be ignored.</p>
</div>
<div class="paragraph">
<p>This changes require adding sync.Mutex to mark if the instance has been
closed or not; which affect createMultiLogger and defaultMLog to return
a pointer to prevent copy on Mutex.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/clise: implement json.Marshaler on Clise</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The MarshalJSON method convert the Clise into slice by calling Slice
and then convert it into JSON.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/reflect: add function Marshal</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Marshal function marshal the obj value to []byte by calling one of
the method: MarshalBinary, MarshalJSON, or MarshalText; in respective
order.</p>
</div>
<div class="paragraph">
<p>If obj implement one of the method with valid signature, it will return
(out, nil, true);
unless there is an error.</p>
</div>
<div class="paragraph">
<p>If the method signature invalid it will return (nil, err, false).</p>
</div>
<div class="paragraph">
<p>If obj is nil or none of the method exist it will return
(nil, nil, false).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">net/html: add function NormalizeForID</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given an input string, The NormalizeForID normalize it to HTML ID.
The normalization follow Mozilla specification [1] rules,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>it must not contain whitespace (spaces, tabs etc.),</p>
</li>
<li>
<p>only ASCII letters, digits, '_', and '-' should be used, and</p>
</li>
<li>
<p>it should start with a letter.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The NormalizeForID do this normalization,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An empty string is equal to "_".</p>
</li>
<li>
<p>Any other unknown characters will be replaced with '_'.</p>
</li>
<li>
<p>If the input does not start with letter, it will be prefixed with
'_', unless it start with '_'.</p>
</li>
<li>
<p>All letters converted to lower case.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>[1] <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id" class="bare">https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id</a>.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/http: add function to unmarshal url.Values using tag <code>form:</code></dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>UnmarshalForm read struct fields tagged with <code>form:</code> from out as key and
set its using the value from url.Values based on that key.
If the field does not have <code>form:</code> tag but it is exported, then it will
use the field name, in case insensitive.</p>
</div>
<div class="paragraph">
<p>Only the following types are supported: bool, int/intX, uint/uintX,
floatX, string, []byte, or type that implement BinaryUnmarshaler
(UnmarshalBinary), json.Unmarshaler (UnmarshalJSON), or TextUnmarshaler
(UnmarshalText).</p>
</div>
<div class="paragraph">
<p>A bool type can be set to true using the following string value: "true",
"yes", or "1".</p>
</div>
<div class="paragraph">
<p>If the input contains multiple values but the field type is not slice,
the field will be set using the first value.</p>
</div>
<div class="paragraph">
<p>It will return an error if the out variable is not set-able (the type is
not a pointer to a struct).
It will not return an error if one of the input value is not match with
field type.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/reflect: implement Set function to set reflect.Value by string</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Set function set the obj value by converting the string val from
parameter to the obj type.</p>
</div>
<div class="paragraph">
<p>If the obj is an interface or struct, its value will be set by calling
Unmarshal.</p>
</div>
<div class="paragraph">
<p>It will return an error if,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>obj is not setable, variable is passed without pointer or pointer
not initialized.</p>
</li>
<li>
<p>val is overflow</p>
</li>
<li>
<p>obj Kind is Invalid, Array, Chan, Func, Map, or UnsafePointer.</p>
</li>
</ul>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/reflect: add function Unmarshal</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Unmarshal function set the obj value by calling one of the method:
UnmarshalBinary, UnmarshalJSON, or UnmarshalText; in respective
order.</p>
</div>
<div class="paragraph">
<p>Just like reflect, the obj value must be pointer to initialized variable
(&T) or pointer-to-pointer to uninitialized variable (**T).</p>
</div>
<div class="paragraph">
<p>If obj implement one of the method, it will return (true, nil) if there is
no error.</p>
</div>
<div class="paragraph">
<p>If none of the method exist on obj, it will return (false, nil).</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/reflect: add function Tag to simplify lookup on struct&#8217;s field tag</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given a StructField and the name of tag, return the tag&#8217;s value and
options inside the tag.
The options is any string after tag&#8217;s value, separated by comma.
For example, given the following field definition</p>
</div>
<div class="literalblock">
<div class="content">
<pre>F `tag:"name,opt1, opt2"`</pre>
</div>
</div>
<div class="paragraph">
<p>It will return (name, [opt1 opt2], true).</p>
</div>
<div class="paragraph">
<p>If the field is exported but does not have tag, it will return the field
name (as is without converting to lower case) in val with hasTag is
false: (Name, nil, false).</p>
</div>
<div class="paragraph">
<p>If the field is un-exported it will return empty val with hasTag is
false ("", nil, false).</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="v0_39_0_enhancements"><a class="anchor" href="#v0_39_0_enhancements"></a><a class="link" href="#v0_39_0_enhancements">Enhancements</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">lib/memfs: update the template format</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Replace ":=" with "var" and realign the field assignments.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">net/html: use inline replacement to clean up white spaces</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Instead of using bytes.Replace, three times, iterate the plain text
manually to clean up the white and multiple spaces.</p>
</div>
<div class="paragraph">
<p>Benchmark result,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name        old time/op    new time/op    delta
Sanitize-8    4.27µs ±10%    2.64µs ±13%  -38.21%  (p=0.000 n=10+10)

name        old alloc/op   new alloc/op   delta
Sanitize-8    4.84kB ± 0%    4.45kB ± 0%   -7.94%  (p=0.000 n=10+10)

name        old allocs/op  new allocs/op  delta
Sanitize-8      13.0 ± 0%       6.0 ± 0%  -53.85%  (p=0.000 n=10+10)</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/mlog: minimize allocation when generating log</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Instead of using two bytes.Buffer pool, use one;
and add space after time and prefix by writing to buffer directly instead
of allocating new arguments to Fprintf.</p>
</div>
<div class="paragraph">
<p>Benchmark result,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>name           old time/op    new time/op    delta
MultiLogger-8    3.97µs ± 3%    3.68µs ± 2%   -7.43%  (p=0.008 n=5+5)

name           old alloc/op   new alloc/op   delta
MultiLogger-8      510B ± 1%      300B ± 1%  -41.13%  (p=0.008 n=5+5)

name           old allocs/op  new allocs/op  delta
MultiLogger-8      10.4 ± 6%       3.4 ±18%  -67.31%  (p=0.008 n=5+5)</pre>
</div>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/dns: use Shutdown to stop DoH server</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using Shutdown allow active connection not interrupted but it may
cause delay when restarting the server.</p>
</div>
<div class="paragraph">
<p>While at it, set the doh and dot server instance to nil to release
the resource, in case the Server need to start again.</p>
</div>
</div>
</div>
</dd>
<dt class="hdlist1">lib/websocket: realign all struct to minimize allocations</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Changes,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Client: from 176 to 144 (-32 bytes)</p>
</li>
<li>
<p>ClientManager: from 64 to 40 (-24 bytes)</p>
</li>
<li>
<p>Frame: from 72 to 56 bytes (-16 bytes).</p>
</li>
<li>
<p>Handshak: from 160 to 120 bytes (-40 bytes).</p>
</li>
<li>
<p>Request: from 88 to 72 (-16 bytes)</p>
</li>
<li>
<p>Response: from 40 to 24 (-16 bytes)</p>
</li>
<li>
<p>route: from 48 to 32 (-16 bytes)</p>
</li>
<li>
<p>Server: from 72 to 64 (-8 bytes)</p>
</li>
<li>
<p>ServerOptions: from 104 to 96 (s-8 bytes)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Plus other structs in the tests.</p>
</div>
</div>
</div>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_38_0"><a class="anchor" href="#v0_38_0"></a><a class="link" href="#v0_38_0">share v0.38.0 (2022-06-05)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release update the minimum Go version to 1.17.</p>
</div>
<div class="sect2">
<h3 id="breaking_changes"><a class="anchor" href="#breaking_changes"></a><a class="link" href="#breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: move all caches operations from Server to Caches type</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously all caches operation are tied to the Server type.</p>
</div>
<div class="paragraph">
<p>In order to separate the responsibilities between server and caches,
we move all caches operations to Cache type.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: change the Zone SOA field type from ResourceRecord to RDataSOA</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using the RDataSOA type directly minimize interface check and conversion.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_38_0_enhancements"><a class="anchor" href="#v0_38_0_enhancements"></a><a class="link" href="#v0_38_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: replace Ticker with Timer on Caches&#8217; worker</p>
<div class="paragraph">
<p>Since the worker call time.Now() inside the body, we can minimize it
by using Timer.</p>
</div>
</li>
<li>
<p>lib/dns: export the Caches type and field on Server</p>
<div class="paragraph">
<p>The idea is move all server&#8217;s caches operations (methods) to this
type later.</p>
</div>
</li>
<li>
<p>lib/dns: split storage between internal and external caches</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the indexed caches for internal (records from hosts or zone
files) and external (records from parent name servers) are stored inside
single map.</p>
</div>
<div class="paragraph">
<p>This changes split those internal and external caches into two maps,
so any operation on one caches does not affect the other one, and vice
versa.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: return the removed record on caches RemoveCachesByRR</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the record being removed found on caches, it will return it;
otherwise it will return nil without error.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: disable JSON marshaling Zone Records field</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>On service that manage many zones, providing an API to fetch list of
zones only will return large payload if we include the Records field
in the response.</p>
</div>
<div class="paragraph">
<p>So, it is recommended to provide another API to fetch the records on
specific zone.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: print the field Value on ResourceRecord Stringer instead of rdlen</p>
</li>
<li>
<p>lib/dns: export the zoneRecords type</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Since the Zone type is exported and its contains exported field Records
with type zoneRecords, then that field type should also exported.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: return the deleted record on HostsFile RemoveRecord</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the RemoveRecord method on HostsFile return a boolean
true if the record found.</p>
</div>
<div class="paragraph">
<p>This changes the return type to the ResourceRecord being deleted,
to allow the caller inspect and/or print the record.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_38_0_chores"><a class="anchor" href="#v0_38_0_chores"></a><a class="link" href="#v0_38_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>all: rewrite all codes to use "var" instead of ":="</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using ":=" simplify the code but we lose the type.  For example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>v := F()</pre>
</div>
</div>
<div class="paragraph">
<p>The only way we know what the type of v is by inspecting the function
F.
Another disadvantages of using ":=" may cause extra variables
allocation where two or more variables with same type is declared
inside body of function where it could be only one.</p>
</div>
<div class="paragraph">
<p>While at it, we split the struct for test case into separate type.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: format comment in embedded Go template according to gofmt tip</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In the next gofmt (Go v1.19), the comment format does not allow empty
lines "//" at the top and bottom of the comment.</p>
</div>
<div class="paragraph">
<p>This changes make the generated Go code from Embed method to match
as close as possible with output of gofmt.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_37_0"><a class="anchor" href="#v0_37_0"></a><a class="link" href="#v0_37_0">share v0.37.0 (2022-05-09)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_37_0_breaking_changes"><a class="anchor" href="#v0_37_0_breaking_changes"></a><a class="link" href="#v0_37_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: refactor Server RemoveCachesByNames to return removed Answer</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, RemoveCachesByNames does not return anything, its only
print the domain name being removed if debugging level is set to &gt;= 1.</p>
</div>
<div class="paragraph">
<p>This changes rewrite the RemoveCachesByNames to return list of Answer
being removed to allow the caller to inspect and/or print the Answer.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: change the Watch method to accept struct</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, we assume that the list of files being Watch-ed is same
with the list of files in Includes.
This may not be correct.
For example, we may want to watch "*.ts" files only but did not want
it to be included during GoEmbed.</p>
</div>
<div class="paragraph">
<p>This changes introduce list of pattern for files to be watched in
the <code>WatchOptions.Watches</code> field.
If this field is empty, only files match the Includes filter will be
watched.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_new_features"><a class="anchor" href="#v0_37_0_new_features"></a><a class="link" href="#v0_37_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: add method to get the record in HostsFile by name and/or value</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Get method return the first resource record that match with domain
name and/or value.
The value parameter is optional, if its empty, then only the first record
that match with domain name that will be returned.</p>
</div>
<div class="paragraph">
<p>If no record matched, it will return nil.</p>
</div>
<div class="paragraph">
<p>While at it, reformat the hosts_file comments with next Go 1.19 format.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: add method CachesClear to remove all caches</p>
</li>
<li>
<p>lib/net: add method to populate query on ResolvConf</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given a domain name to be resolved, the PopulateQuery generate
list of names to be queried based on registered Domain and Search
in the resolv.conf file.</p>
</div>
<div class="paragraph">
<p>The domain name itself will be on top of the list if its contains any
dot.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: add function to create new client using name server URL</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The NewClient create new DNS client using the name server URL.
The name server URL is defined in the same format as ServerOptions&#8217;s
NameServer.</p>
</div>
<div class="paragraph">
<p>The function also accept second parameter: isInsecure, which is only
usable for DNS over TLS and DNS over HTTPS.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_bug_fixes"><a class="anchor" href="#v0_37_0_bug_fixes"></a><a class="link" href="#v0_37_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/ini: fix panic when marshaling unexported field with type struct</p>
<div class="paragraph">
<p>While at it, split the example for marshaling and unmarshaling
struct into separate examples.</p>
</div>
</li>
<li>
<p>lib/memfs: make the Node&#8217;s addChild to be idempotent</p>
<div class="paragraph">
<p>If the same Node&#8217;s Path already exists on the Childs, adding another
Node with same Path should not add the Node to the Childs.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_enhancements"><a class="anchor" href="#v0_37_0_enhancements"></a><a class="link" href="#v0_37_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/ini: implement marshaling and unmarshaling map with struct element</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For a field F with type map[K]S <code>ini:"sec"</code>, where K is string and S is
a struct or pointer to struct element, marshaling the field F will
result in the following ini format,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[sec "K"]
&lt;S.Field.Tag&gt; = &lt;S.Field.Value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Each field in struct S unmarshaled normally as "key = value".</p>
</div>
<div class="paragraph">
<p>This rule is also applied when unmarshalling from ini text into map[K]V.</p>
</div>
<div class="paragraph">
<p>This implementation allow multiple section with dynamic subsections as
key.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_chores"><a class="anchor" href="#v0_37_0_chores"></a><a class="link" href="#v0_37_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>all: reformat all codes using gofmt 1.19 (the Go tip)</p>
</li>
<li>
<p>all: replace any usage of ioutil package with <code>os</code> or <code>io</code>
</p>
<div class="paragraph">
<p>Since Go 1.16, the ioutil package has been deprecated.
This changes replace any usage that use functions from ioutil package
with their replacement from package os or package io.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_36_0"><a class="anchor" href="#v0_36_0"></a><a class="link" href="#v0_36_0">share v0.36.0 (2022-04-03)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_36_0_breaking_changes"><a class="anchor" href="#v0_36_0_breaking_changes"></a><a class="link" href="#v0_36_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: update the file mode and/or content on DirWatcher</p>
<div class="paragraph">
<p>Previously, the DirWatcher only forward the NodeState if the file being
watched is deleted or modified.</p>
</div>
<div class="paragraph">
<p>This changes the DirWatcher handle it internally.
If the file is deleted it will be removed from internal MemFS instance.
If the file is updated it will update the mode or content of that file
in the MemFS.</p>
</div>
</li>
<li>
<p>lib/memfs: changes the DirWatcher and Watcher to use channel</p>
<div class="paragraph">
<p>Previously, we use a callback model to propagated changes.
This model has its advantages and disadvantages.</p>
</div>
<div class="paragraph">
<p>The advantages is there is no limit of queue when the changes need to
be propagated to the caller.
The disadvantages of that the watcher needs to wait for callback to
finish before continue processing.
One can run it under goroutine, but it may cause race if the caller does
not handle update properly and it does not guarantee the goroutine
process it in FIFO.
We can see this on the unit test of NewWatcher, we needs to use
sync.WaitGroup to properly check one changes before processing the order.</p>
</div>
<div class="paragraph">
<p>This commit changes the DirWatcher and Watcher to use channel, like
the one in time.Ticker.</p>
</div>
</li>
<li>
<p>all: move the DirWatcher and Watcher types from io to memfs</p>
<div class="paragraph">
<p>There are two reasons why we move them.
First, DirWatcher and Watcher code internally depends on the memfs
package, especially on Node type.
Second, we want to add new Watch method to MemFS which depends on
package io.
If we do that, there will be circular imports.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="new_features"><a class="anchor" href="#new_features"></a><a class="link" href="#new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: implement handler to check each request to Server Memfs</p>
<div class="paragraph">
<p>The FSHandler define the function to inspect each GET request to Server
MemFS instance.
The node parameter contains the requested file inside the memfs.</p>
</div>
<div class="paragraph">
<p>If the handler return true, server will continue processing the node
(writing the Node content type, body, and so on).</p>
</div>
<div class="paragraph">
<p>If the handler return false, server stop processing the node and return
immediately, which means the function should have already handle writing
the header, status code, and/or body.</p>
</div>
</li>
<li>
<p>lib/memfs: add method to stop the Watch</p>
<div class="paragraph">
<p>The StopWatch method stop watching for update, from calling Watch.</p>
</div>
</li>
<li>
<p>lib/xmlrpc: add method to get boolean field value on Value</p>
<div class="paragraph">
<p>The GetFieldAsBoolean return the struct&#8217;s field value by its key as
bool type.</p>
</div>
</li>
<li>
<p>lib/memfs: add method Watch to MemFS</p>
<div class="paragraph">
<p>The Watch method create and start a DirWatcher that ready to be consumed.</p>
</div>
<div class="paragraph">
<p>This is to simplify watching an existing MemFS instance because the
internal fs inside the DirWatcher is not exported.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="enhancements"><a class="anchor" href="#enhancements"></a><a class="link" href="#enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: use package mlog for logging</p>
<div class="paragraph">
<p>In case the consumer of lib/http package use mlog for logging, the
log will be written to their predefined writers.</p>
</div>
<div class="paragraph">
<p>In case they did not use mlog, the log will written to stdout and stderr.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="bug_fixes"><a class="anchor" href="#bug_fixes"></a><a class="link" href="#bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: check for possible nil on Get</p>
<div class="paragraph">
<p>In case the instance of memfs is set to nil (for example, the root
directory being watched is deleted on DirWatcher), the Get method will
cause panic after the next update on content of root directory.</p>
</div>
</li>
<li>
<p>lib/xmlrpc: use %v to convert non-string type on GetFieldAsString</p>
<div class="paragraph">
<p>Previously, if GetFieldAsString is called and the struct field type is
not string, it will return "%s(&lt;type&gt;=&lt;value&gt;)" instead of the value
in string.</p>
</div>
<div class="paragraph">
<p>This commit fix this issue by using %v to convert non-string type.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="chores"><a class="anchor" href="#chores"></a><a class="link" href="#chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: differentiate prefix on MemFS&#8217;s Update and Node&#8217;s Update</p>
</li>
<li>
<p>email/dkim: remove amazonses.com domain from test cases</p>
<div class="paragraph">
<p>The domain now return invalid public key record, so we removed them
to make the test passed for now.</p>
</div>
</li>
<li>
<p>lib/memfs: move the test for NewWatcher and DirWatcher as example</p>
<div class="paragraph">
<p>With this we do one thing (write testing) and output two things (testing
the code and give an example for code).</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_35_0"><a class="anchor" href="#v0_35_0"></a><a class="link" href="#v0_35_0">share v0.35.0 (2022-03-04)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_35_0_breaking_changes"><a class="anchor" href="#v0_35_0_breaking_changes"></a><a class="link" href="#v0_35_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/email: change the Header and Body fields on Message to non-pointer.</p>
<div class="paragraph">
<p>The idea is to minimize GC pressure on system with many messages,
minimize checking for nil value, and make an empty Message ready to use
without any initialization.</p>
</div>
</li>
<li>
<p>lib/smtp: refactoring NewClient to use struct instead of parameters.</p>
<div class="paragraph">
<p>Previously, to create new client one must pass three parameters to
NewClient function: localName, remoteURL, and insecure.
If we want to add another parameters in the future, it will cause the
function signature changes.</p>
</div>
<div class="paragraph">
<p>This changes simplify creating NewClient by passing single struct
with new parameters: AuthUser, AuthPass, and AuthMechanism.
If both AuthUser and AuthPass is not empty, the NewClient will
authenticate the connection, minimize number of step on the caller.</p>
</div>
</li>
<li>
<p>lib/smtp: rename Mechanism to SaslMechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_new_features"><a class="anchor" href="#v0_35_0_new_features"></a><a class="link" href="#v0_35_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>cmd/sendemail: command line interface to send an email.</p>
<div class="paragraph">
<p>The sendemail command is proof of concept on how to use lib/email and
lib/smtp to write and send email through SMTP.</p>
</div>
</li>
<li>
<p>cmd/xtrk: command line interface to uncompress and/or un-archive file.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>xtrk accept single file to uncompress and/or archived into a directory
output dir".
If directory output "dir" is not defined, it will be set to current
directory.</p>
</div>
<div class="paragraph">
<p>The compression and archive format is detected automatically based on the
following file input extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>.bz2: decompress using bzip2.</p>
</li>
<li>
<p>.gz: decompress using gzip.</p>
</li>
<li>
<p>.tar: unarchive using tar.</p>
</li>
<li>
<p>.zip: unarchive using zip.</p>
</li>
<li>
<p>.tar.bz2: decompress using bzip2 and unarchive using tar.</p>
</li>
<li>
<p>.tar.gz: decompresss using gzip and unarchive using tar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The input file will be removed on success.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_enhancements"><a class="anchor" href="#v0_35_0_enhancements"></a><a class="link" href="#v0_35_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: increase the default UDP packet size to 1232.</p>
<div class="paragraph">
<p>The value is based on recommendation by <a href="https://dnsflagday.net/2020/" class="bare">https://dnsflagday.net/2020/</a>
to prevent IP fragmentation when supporting EDNS message.</p>
</div>
</li>
<li>
<p>lib/memfs: export the Remount method.</p>
<div class="paragraph">
<p>The Remount method reset the memfs instance to force rescanning
the files again from file system.</p>
</div>
</li>
<li>
<p>lib/email: set the Date and Message-ID on Message Pack.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Calling Pack now set the Date header if its not exist, using the local
time;  and the message-id header if its not exist using the following
format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;epoch&gt;.&lt;random-8-chars&gt;@&lt;local-hostname&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The random-8-chars is Seed-ed from Epoch(), so does the boundary.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: make Message Pack works with single text or HTML part.</p>
<div class="paragraph">
<p>Previously, the Pack method generate multipart/alternative message only.</p>
</div>
<div class="paragraph">
<p>Since the Message now can set the body text and HTML, without using
NewMultipart, the Pack method need to be able to accommodate this.</p>
</div>
</li>
<li>
<p>lib/email: add methods to modify Message.</p>
<div class="paragraph">
<p>Previously, a Message can be created only using NewMultipart, which
generate message with text and HTML.</p>
</div>
<div class="paragraph">
<p>This changes add methods to compose a Message: AddCC, AddTo, SetBodyHtml,
SetBodyText, SetCC, SetFrom, SetSubject, and SetTo.</p>
</div>
</li>
<li>
<p>lib/email: set the header Date field on NewMultipart.</p>
<div class="paragraph">
<p>The Date field value is set to current time on the system that
generated the message.</p>
</div>
<div class="paragraph">
<p>The date format is set to "Mon, 2 Jan 2006 15:04:05 -0700" according
to RFC 5322 section 3.3.</p>
</div>
</li>
<li>
<p>lib/smtp: add status codes from RFC 4954.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following status codes are added,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>432: StatusPasswordTransitionNeeded, from section 4.7.12.</p>
</li>
<li>
<p>454: StatusTemporaryAuthFailure, from section 4.7.0.</p>
</li>
<li>
<p>534: StatusAuthMechanismTooWeak, from section 5.7.9.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/mlog: make the Outf method always add new line at the end.</p>
<div class="paragraph">
<p>One of common mistakes when using logging library is to put the new line
"n" at the end of format string, which cause delayed output written
to Stdout (the OS wait for "n" as signal for printing).</p>
</div>
<div class="paragraph">
<p>This changes check new line to every call of Outf method and add it if
its not exist.</p>
</div>
<div class="paragraph">
<p>If the caller need to call Outf multiple times before ending it with
new line, they should handle it manually by storing into temporary
buffer first and call Outf at the end.</p>
</div>
</li>
<li>
<p>lib/memfs: add option CommentHeader to EmbedOptions.</p>
<div class="paragraph">
<p>The CommentHeader option allow user to define custom header to the Go
generated file.
The string value is not checked, whether it&#8217;s a comment or not, it
will rendered as is.</p>
</div>
</li>
<li>
<p>lib/ini: make the Marshal on map field sorted by keys</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given the following struct,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>type ADT struct {
	Amap map[string]string `ini:"section:sub"`
}</pre>
</div>
</div>
<div class="paragraph">
<p>and ini text,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[test "map"]
c = 3
b = 2
a = 1</pre>
</div>
</div>
<div class="paragraph">
<p>Unmarshal-ing the text into ADT and then Marshal-ing it again will
result in unpredictable keys order.</p>
</div>
<div class="paragraph">
<p>This changes fix this issue by sorting the keys on ADT.Amap on
Marshal-ing, to make the written output predictable.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_bug_fixes"><a class="anchor" href="#v0_35_0_bug_fixes"></a><a class="link" href="#v0_35_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/io: fix DirWatcher not removing old files on rename.</p>
<div class="paragraph">
<p>Previously, if a sub-directory being watched by DirWatcher is renamed,
the old directory does not get removed from field dirs.</p>
</div>
<div class="paragraph">
<p>This commit fix this issue by deleting the sub directory on unmpSubdirs.</p>
</div>
<div class="paragraph">
<p>While at it, guard any read/write to dirs field with mutex to prevent
data race.</p>
</div>
</li>
<li>
<p>lib/dns: check for possible index out of range when unpacking RR.</p>
<div class="paragraph">
<p>There is a possibility that record data (rdata) length inside the
packet is greater than length of packet itself.  Some of the reasons are
corrupted packet from server or packet poisoning (attacking the DNS
server by sending invalid packet).</p>
</div>
<div class="paragraph">
<p>This changes fix this issue by checking the index and rdata length with
the length of packet before consuming the rdata itself.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_chores"><a class="anchor" href="#v0_35_0_chores"></a><a class="link" href="#v0_35_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/smtp: provide an example of how to create MailTx from email package.</p>
<div class="paragraph">
<p>If one read the current documentation on how to use the Client.SendTx,
there is a missing link on how to create and populate MailTx.</p>
</div>
<div class="paragraph">
<p>This changes provide the example using the email package to generate
the MailTx Data.</p>
</div>
</li>
<li>
<p>lib/mlog: change default mlog instance to non-pointer.</p>
<div class="paragraph">
<p>Since the default mlog instance is a global variable, using non-pointer
give advantages on minimize GC pressure.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_34_0"><a class="anchor" href="#v0_34_0"></a><a class="link" href="#v0_34_0">share v0.34.0 (2022-02-05)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_34_0_breaking_changes"><a class="anchor" href="#v0_34_0_breaking_changes"></a><a class="link" href="#v0_34_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/sql: make the table migration customizable</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In the method Migrate() we add parameter "tableMigration" which define
the name of table where the state of migration will be saved.</p>
</div>
<div class="paragraph">
<p>If its empty default to "_migration".</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_new_features"><a class="anchor" href="#v0_34_0_new_features"></a><a class="link" href="#v0_34_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/os: implement function to Extract compressed and/or archived file</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Extract function uncompress and/or unarchive file from fileInput
into directory defined by dirOutput.
This is the high level API that combine standard archive/zip, archive/tar,
compress/bzip2, and/or compress/gzip.</p>
</div>
<div class="paragraph">
<p>The compression and archive format is detected automatically based on
the following fileInput extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>.bz2: decompress using compress/bzip2.</p>
</li>
<li>
<p>.gz: decompress using compress/gzip.</p>
</li>
<li>
<p>.tar: unarchive using archive/tar.</p>
</li>
<li>
<p>.zip: unarchive using archive/zip.</p>
</li>
<li>
<p>.tar.bz2: decompress using compress/bzip2 and unarchive using
archive/tar.</p>
</li>
<li>
<p>.tar.gz: decompress using compress/gzip and unarchive using
archive/tar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The output directory, dirOutput, where the decompressed and/or unarchived
file stored. will be created if not exist.
If its empty, it will set to current directory.</p>
</div>
<div class="paragraph">
<p>On success, the compressed and/or archived file will be removed from the
file system.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: implement method Download() on Client</p>
<div class="paragraph">
<p>The Download method get a resource from remote server and write it into
DownloadRequest.Output (a io.Writer).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_enhancements"><a class="anchor" href="#v0_34_0_enhancements"></a><a class="link" href="#v0_34_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/websocket: return error if parameter is empty on RegisterTextHandler</p>
<div class="paragraph">
<p>Previously, the RegisterTextHandler method return nil if method, target,
or handler parameter is not set.
This may cause confusion and hard to debug handler when no connection receive
but the RegisterTextHandler does not have any error.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_chores"><a class="anchor" href="#v0_34_0_chores"></a><a class="link" href="#v0_34_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: change the test port for testing HTTP server</p>
<div class="paragraph">
<p>Previously, the test port for HTTP server is set to 8080 and may conflict
with any service that running on the local (due to common use of 8080).</p>
</div>
<div class="paragraph">
<p>This changes it to 14832 and we make the full server address stored
as global variable so any tests can references it.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_33_0"><a class="anchor" href="#v0_33_0"></a><a class="link" href="#v0_33_0">share v0.33.0 (2022-01-09)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Happy New Year!</p>
</div>
<div class="paragraph">
<p>Three years has passed since the first release of this multi-libraries (or Go
module), and we have released at least 33 new features with several bugs here
and there.</p>
</div>
<div class="paragraph">
<p>For anyone who use this module, I hope it help you, as the module name
intended "share", and sorry if its too many breaking changes.</p>
</div>
<div class="paragraph">
<p>Live long and prosper!
See you again next year.</p>
</div>
<div class="sect2">
<h3 id="v0_33_0_new_features"><a class="anchor" href="#v0_33_0_new_features"></a><a class="link" href="#v0_33_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>cmd/gofilemode: new command to decode the Go file mode</p>
<div class="paragraph">
<p>The Go has their own file mode that works across all operating system.
The file mode is represented by uint64, the command line will convert it
to fs.FileMode and print each possible flag on it including the
permission.</p>
</div>
</li>
<li>
<p>lib/sql: make the TruncateTable run with cascade and restart identity</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>On table that contains foreign key, truncate without cascade may cause
the method fail.</p>
</div>
<div class="paragraph">
<p>Also, since TruncateTable is, and should be only, used on testing, any
identity columns, for example serial, should be reset back to its initial
value. On PostgreSQL this means the truncate table is with
"RESTART IDENTITY".</p>
</div>
</div>
</div>
</li>
<li>
<p>cmd/epoch: command line to print and parse Unix timestamp</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Program epoch print the current time (Unix seconds, milliseconds,
nanoseconds, local time, and UTC time) or the time based on the epoch on
first parameter.
Usage,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>epoch &lt;unix-seconds|unix-milliseconds|unix-nanoseconds&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Without a parameter, it will print the current time.
With single parameter, it will print the time based on that epoch.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_breaking_changes"><a class="anchor" href="#v0_33_0_breaking_changes"></a><a class="link" href="#v0_33_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: refactoring NewClient to accept single struct</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the NewClient function accept three parameters: serverURL,
http.Header, and insecure.  If we want to add another parameter,
for example timeout it will cause changes on the function signature.</p>
</div>
<div class="paragraph">
<p>To prevent this changes in the future, we change it now. The NewClient
now accept single struct.</p>
</div>
<div class="paragraph">
<p>While at it, we add option to set Timeout.</p>
</div>
<div class="paragraph">
<p>The Timeout affect the http Transport Timeout and TLSHandshakeTimeout.
The field is optional, if not set it will set to 10 seconds.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: remove field memfs.Options in ServerOptions</p>
<div class="paragraph">
<p>This options is duplicate with Memfs.Opts.</p>
</div>
</li>
<li>
<p>lib/websocket: add "ok" return value on ClientManager Context</p>
<div class="paragraph">
<p>The ok return value will be true if the context exist or false otherwise.</p>
</div>
</li>
<li>
<p>lib/memfs: remove field ContentEncoding from EmbedOptions and Node</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The original idea for option ContentEncoding in EmbedOptions and Node
is to save spaces, compressing the content on disk on embedding and
doing transport, when the MemFS instance is used to serve the (embedded)
contents of file system.</p>
</div>
<div class="paragraph">
<p>This option turns out break the HTTP content negotiation [1] of
accept-encoding header, if the HTTP server does not handle it properly,
which default Go HTTP server does not.</p>
</div>
<div class="paragraph">
<p>In order to prevent this issue in the future, for anyone who use the
memfs for serving static HTTP contents, we remove the options and store
the embedded content as is and let the HTTP server handle how the
compression by itself.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: refacforing ParseMailbox</p>
<div class="paragraph">
<p>This commit changes the signature of ParseMailbox by returning no error.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>[1] <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation" class="bare">https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_bug_fixes"><a class="anchor" href="#v0_33_0_bug_fixes"></a><a class="link" href="#v0_33_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: skip mount if the Root node has been initialized</p>
</li>
<li>
<p>lib/websocket: fix race conditition on handleText</p>
<div class="paragraph">
<p>Instead of accessing the ctx field directly, call the Context() method
to prevent data race.</p>
</div>
</li>
<li>
<p>lib/sql: check for EOF on loadSQL</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>There is probably a regression in Go that cause ioutil.ReadAll return
io.EOF, while it should not, because the documentation said that</p>
</div>
<div class="literalblock">
<div class="content">
<pre>A successful call returns err == nil, not err == EOF.</pre>
</div>
</div>
<div class="paragraph">
<p>But in this, using http.FileSystem, the ioutil.ReadAll now return EOF
and we need to check it to make the migration can run without an error.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_enhancements"><a class="anchor" href="#v0_33_0_enhancements"></a><a class="link" href="#v0_33_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/io: realign all structs</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The struct realign, save the occupied of struct size in the memory,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DirWatcher: from 184 to 144 bytes (-40 bytes)</p>
</li>
<li>
<p>Reader: from 16 to 8 bytes (-8 bytes)</p>
</li>
<li>
<p>Watcher: from 32 to 24 bytes (-8 bytes)</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: realign all structs</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Changes,
* Client: from 56 to 48 bytes (-8 bytes)
* CORSOptions: from 104 to 88 bytes (-16 bytes)
* Endpoint: from 64 to 32 bytes (-32 bytes)
* EndpointRequest: from 72 to 56 bytes (-16 bytes)
* route: from 56 to 32 bytes (-24 bytes)</p>
</div>
<div class="paragraph">
<p>Other changes is struct on unit tests.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: add method Init</p>
<div class="paragraph">
<p>The Init provided to initialize MemFS instance if its Options is set
directly, not through New() function.</p>
</div>
</li>
<li>
<p>lib/memfs: embed the Embed options and GenFuncName</p>
<div class="paragraph">
<p>This is to make the instance of memfs initialize from init is reusable.</p>
</div>
</li>
<li>
<p>lib/memfs: realign struct Node, Options, PathNode, and on unit tests</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The realign save storage spaces on struct,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node: from 240 to 224 bytes (-16 bytes)</p>
</li>
<li>
<p>Options: from 112 to 104 bytes (-8 bytes)</p>
</li>
<li>
<p>PathNode: from 16 to 8 bytes (-8 bytes)</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: realign the struct Mailbox</p>
<div class="paragraph">
<p>This changes the storage size from 80 to 72 bytes (-8 bytes).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_chores"><a class="anchor" href="#v0_33_0_chores"></a><a class="link" href="#v0_33_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>github/workflows: remove step to get dependencies</p>
<div class="paragraph">
<p>The Go module should handle the dependencies automatically.</p>
</div>
</li>
<li>
<p>github/workflows: set go version to 1.17.6</p>
</li>
<li>
<p>lib/email: convert the unit test for ParseMailbox to examples</p>
<div class="paragraph">
<p>Since the ParseMailbox is public we can provide an examples and test
at the same times.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-08-05 20:59:02 +0700
</div>
</div></div>
		</div>

		<div class="footer">
			Powered by <a
				href="https://git.sr.ht/~shulhan/ciigo"
			>
				ciigo
			</a>
		</div>
	</body>
</html>