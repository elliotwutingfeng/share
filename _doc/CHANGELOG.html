<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1" />
		<meta name="theme-color" content="#375EAB" />

		<title>CHANGELOG</title>

		<style>
		
body {
	margin: 0;
	font-family: Arial, sans-serif;
	background-color: #fff;
	line-height: 1.3;
	text-align: center;
	color: #222;
}
pre,
code {
	font-family: Menlo, monospace;
	font-size: 0.875rem;
}
pre {
	line-height: 1.4;
	overflow-x: auto;
	background: #efefef;
	padding: 0.625rem;
	border-radius: 0.3125rem;
}
a {
	color: #007d9c;
	text-decoration: none;
}
a:hover {
	text-decoration: underline;
}

p,
li {
	max-width: 50rem;
	word-wrap: break-word;
}
li p {
	margin: 2px;
}
p,
pre,
ul,
ol {
	margin: 1.25rem;
}

h1,
h2,
h3,
h4 {
	margin: 1.25rem 0 1.25rem;
	padding: 0;
	color: #007d9c;
	font-weight: bold;
}
h1 {
	font-size: 1.75rem;
	line-height: 1;
}
h1 .text-muted {
	color: #777;
}
h2 {
	clear: right;
	font-size: 1.25rem;
	background: #e0ebf5;
	padding: 0.5rem;
	line-height: 1.25;
	font-weight: normal;
	overflow: auto;
	overflow-wrap: break-word;
}
h2 a {
	font-weight: bold;
}
h3 {
	font-size: 1.25rem;
	line-height: 1.25;
	overflow: auto;
	overflow-wrap: break-word;
}
h3,
h4 {
	margin: 1.25rem 0.3125rem;
}
h4 {
	font-size: 1rem;
}

h2 > span,
h3 > span {
	float: right;
	margin: 0 25px 0 0;
	font-weight: normal;
	color: #5279c7;
}

dl {
	margin: 1.25rem;
}
dd {
	margin: 0 0 0 1.25rem;
}
dl,
dd {
	font-size: 0.875rem;
}

/**
 * Custom classes for pages
 */

.topbar {
	background: #e0ebf5;
	height: 4rem;
	overflow: hidden;
}

.topbar .top-heading,
.topbar .menu {
	padding: 1.313rem 0;
	font-size: 1.25rem;
	font-weight: normal;
}
.topbar .top-heading {
	float: left;
}
.topbar .top-heading a {
	color: #222;
	text-decoration: none;
}

.top-heading .header-logo {
	height: 2rem;
	width: 5.125rem;
}

.topbar .menu {
	float: right;
}
.topbar .menu a {
	margin: 0.625rem 0.125rem;
	padding: 0.625rem;
	color: white;
	background: #007d9c;
	border: 0.0625rem solid #007d9c;
	border-radius: 5px;
}
.topbar .menu form {
	display: inline-block;
}

.page {
	width: 100%;
}

.page > .container,
.topbar > .container,
.footer > .container {
	margin-left: auto;
	margin-right: auto;
	padding: 0 1.25rem;
	max-width: 59.38rem;
}

.page > .container {
	text-align: left;
}

.container .meta {
	font-style: italic;
	margin: 1.25rem;
}

.footer {
	text-align: center;
	color: #666;
	font-size: 0.875rem;
	margin: 2.5rem 0;
}

.ulist li .paragraph {
	margin-bottom: 1em;
}

.ulist li .paragraph {
	margin-bottom: 1em;
}

/** Custom classes */
#toctitle {
	display: none;
}
#toc li {
	list-style: none;
}
#toc ul .sectlevel1 {
	padding: 0px;
	margin: 4px;
}
#toc ul .sectlevel2 {
	margin: 4px;
}

@media screen and (max-width: 992px) {
	#toc {
		all: unset;
	}
}

		</style>
	</head>
	<body>
		<div class="topbar">
			<div class="container">
				<div class="top-heading">
					<a href="/">ciigo</a>
				</div>
				<div class="menu">
					<form class="item" action="/_internal/search">
						<input type="text" name="q" placeholder="Search" />
					</form>
				</div>
			</div>
		</div>

		<div class="page">
			<div class="container">
				
<div id="header">
<h1>CHANGELOG</h1>
<div class="details">
<span id="author" class="author">Shulhan</span><br>
<span id="email" class="email"><a href="mailto:ms@kilabit.info">ms@kilabit.info</a></span><br>
<span id="revdate">31 May 2022</span>
</div>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#v0_38_0">share v0.38.0 (2022-06-05)</a>
<ul class="sectlevel2">
<li><a href="#_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_38_0_enhancements">Enhancements</a></li>
<li><a href="#v0_38_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_37_0">share v0.37.0 (2022-05-09)</a>
<ul class="sectlevel2">
<li><a href="#v0_37_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_37_0_new_features">New features</a></li>
<li><a href="#v0_37_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_37_0_enhancements">Enhancements</a></li>
<li><a href="#v0_37_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_36_0">share v0.36.0 (2022-04-03)</a>
<ul class="sectlevel2">
<li><a href="#v0_36_0_breaking_changes">Breaking changes</a></li>
<li><a href="#_new_features">New features</a></li>
<li><a href="#_enhancements">Enhancements</a></li>
<li><a href="#_bug_fixes">Bug fixes</a></li>
<li><a href="#_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_35_0">share v0.35.0 (2022-03-04)</a>
<ul class="sectlevel2">
<li><a href="#v0_35_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_35_0_new_features">New features</a></li>
<li><a href="#v0_35_0_enhancements">Enhancements</a></li>
<li><a href="#v0_35_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_35_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_34_0">share v0.34.0 (2022-02-05)</a>
<ul class="sectlevel2">
<li><a href="#v0_34_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_34_0_new_features">New features</a></li>
<li><a href="#v0_34_0_enhancements">Enhancements</a></li>
<li><a href="#v0_34_0_chores">Chores</a></li>
</ul>
</li>
<li><a href="#v0_33_0">share v0.33.0 (2022-01-09)</a>
<ul class="sectlevel2">
<li><a href="#v0_33_0_new_features">New features</a></li>
<li><a href="#v0_33_0_breaking_changes">Breaking changes</a></li>
<li><a href="#v0_33_0_bug_fixes">Bug fixes</a></li>
<li><a href="#v0_33_0_enhancements">Enhancements</a></li>
<li><a href="#v0_33_0_chores">Chores</a></li>
</ul>
</li>
</ul>

</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This library is released every month, usually at the first week of month.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2021.html" target="_blank" rel="noopener">Changelog in 2021</a>.
This is changelog for share module since v0.22.0 until v0.32.0.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2020.html" target="_blank" rel="noopener">Changelog in 2020</a>.
This is changelog for share module since v0.12.0 until v0.21.0.</p>
</div>
<div class="paragraph">
<p><a href="CHANGELOG_2018-2019.html" target="_blank" rel="noopener">Changelog from 2018 to 2019</a>.
This is changelog for share module since v0.1.0 until v0.11.0.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_38_0"><a class="anchor" href="#v0_38_0"></a><a class="link" href="#v0_38_0">share v0.38.0 (2022-06-05)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This release update the minimum Go version to 1.17.</p>
</div>
<div class="sect2">
<h3 id="_breaking_changes"><a class="anchor" href="#_breaking_changes"></a><a class="link" href="#_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: move all caches operations from Server to Caches type</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously all caches operation are tied to the Server type.</p>
</div>
<div class="paragraph">
<p>In order to separate the responsibilities between server and caches,
we move all caches operations to Cache type.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: change the Zone SOA field type from ResourceRecord to RDataSOA</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using the RDataSOA type directly minimize interface check and conversion.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_38_0_enhancements"><a class="anchor" href="#v0_38_0_enhancements"></a><a class="link" href="#v0_38_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: replace Ticker with Timer on Caches&#8217; worker</p>
<div class="paragraph">
<p>Since the worker call time.Now() inside the body, we can minimize it
by using Timer.</p>
</div>
</li>
<li>
<p>lib/dns: export the Caches type and field on Server</p>
<div class="paragraph">
<p>The idea is move all server&#8217;s caches operations (methods) to this
type later.</p>
</div>
</li>
<li>
<p>lib/dns: split storage between internal and external caches</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the indexed caches for internal (records from hosts or zone
files) and external (records from parent name servers) are stored inside
single map.</p>
</div>
<div class="paragraph">
<p>This changes split those internal and external caches into two maps,
so any operation on one caches does not affect the other one, and vice
versa.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: return the removed record on caches RemoveCachesByRR</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>If the record being removed found on caches, it will return it;
otherwise it will return nil without error.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: disable JSON marshaling Zone Records field</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>On service that manage many zones, providing an API to fetch list of
zones only will return large payload if we include the Records field
in the response.</p>
</div>
<div class="paragraph">
<p>So, it is recommended to provide another API to fetch the records on
specific zone.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: print the field Value on ResourceRecord Stringer instead of rdlen</p>
</li>
<li>
<p>lib/dns: export the zoneRecords type</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Since the Zone type is exported and its contains exported field Records
with type zoneRecords, then that field type should also exported.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: return the deleted record on HostsFile RemoveRecord</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the RemoveRecord method on HostsFile return a boolean
true if the record found.</p>
</div>
<div class="paragraph">
<p>This changes the return type to the ResourceRecord being deleted,
to allow the caller inspect and/or print the record.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_38_0_chores"><a class="anchor" href="#v0_38_0_chores"></a><a class="link" href="#v0_38_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>all: rewrite all codes to use "var" instead of ":="</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Using ":=" simplify the code but we lose the type.  For example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>v := F()</pre>
</div>
</div>
<div class="paragraph">
<p>The only way we know what the type of v is by inspecting the function
F.
Another disadvantages of using ":=" may cause extra variables
allocation where two or more variables with same type is declared
inside body of function where it could be only one.</p>
</div>
<div class="paragraph">
<p>While at it, we split the struct for test case into separate type.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: format comment in embedded Go template according to gofmt tip</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In the next gofmt (Go v1.19), the comment format does not allow empty
lines "//" at the top and bottom of the comment.</p>
</div>
<div class="paragraph">
<p>This changes make the generated Go code from Embed method to match
as close as possible with output of gofmt.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_37_0"><a class="anchor" href="#v0_37_0"></a><a class="link" href="#v0_37_0">share v0.37.0 (2022-05-09)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_37_0_breaking_changes"><a class="anchor" href="#v0_37_0_breaking_changes"></a><a class="link" href="#v0_37_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: refactor Server RemoveCachesByNames to return removed Answer</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, RemoveCachesByNames does not return anything, its only
print the domain name being removed if debugging level is set to &gt;= 1.</p>
</div>
<div class="paragraph">
<p>This changes rewrite the RemoveCachesByNames to return list of Answer
being removed to allow the caller to inspect and/or print the Answer.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: change the Watch method to accept struct</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, we assume that the list of files being Watch-ed is same
with the list of files in Includes.
This may not be correct.
For example, we may want to watch "*.ts" files only but did not want
it to be included during GoEmbed.</p>
</div>
<div class="paragraph">
<p>This changes introduce list of pattern for files to be watched in
the <code>WatchOptions.Watches</code> field.
If this field is empty, only files match the Includes filter will be
watched.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_new_features"><a class="anchor" href="#v0_37_0_new_features"></a><a class="link" href="#v0_37_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: add method to get the record in HostsFile by name and/or value</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Get method return the first resource record that match with domain
name and/or value.
The value parameter is optional, if its empty, then only the first record
that match with domain name that will be returned.</p>
</div>
<div class="paragraph">
<p>If no record matched, it will return nil.</p>
</div>
<div class="paragraph">
<p>While at it, reformat the hosts_file comments with next Go 1.19 format.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: add method CachesClear to remove all caches</p>
</li>
<li>
<p>lib/net: add method to populate query on ResolvConf</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given a domain name to be resolved, the PopulateQuery generate
list of names to be queried based on registered Domain and Search
in the resolv.conf file.</p>
</div>
<div class="paragraph">
<p>The domain name itself will be on top of the list if its contains any
dot.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/dns: add function to create new client using name server URL</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The NewClient create new DNS client using the name server URL.
The name server URL is defined in the same format as ServerOptions&#8217;s
NameServer.</p>
</div>
<div class="paragraph">
<p>The function also accept second parameter: isInsecure, which is only
usable for DNS over TLS and DNS over HTTPS.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_bug_fixes"><a class="anchor" href="#v0_37_0_bug_fixes"></a><a class="link" href="#v0_37_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/ini: fix panic when marshaling unexported field with type struct</p>
<div class="paragraph">
<p>While at it, split the example for marshaling and unmarshaling
struct into separate examples.</p>
</div>
</li>
<li>
<p>lib/memfs: make the Node&#8217;s addChild to be idempotent</p>
<div class="paragraph">
<p>If the same Node&#8217;s Path already exists on the Childs, adding another
Node with same Path should not add the Node to the Childs.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_enhancements"><a class="anchor" href="#v0_37_0_enhancements"></a><a class="link" href="#v0_37_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/ini: implement marshaling and unmarshaling map with struct element</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>For a field F with type map[K]S <code>ini:"sec"</code>, where K is string and S is
a struct or pointer to struct element, marshaling the field F will
result in the following ini format,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[sec "K"]
&lt;S.Field.Tag&gt; = &lt;S.Field.Value&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Each field in struct S unmarshaled normally as "key = value".</p>
</div>
<div class="paragraph">
<p>This rule is also applied when unmarshalling from ini text into map[K]V.</p>
</div>
<div class="paragraph">
<p>This implementation allow multiple section with dynamic subsections as
key.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_37_0_chores"><a class="anchor" href="#v0_37_0_chores"></a><a class="link" href="#v0_37_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>all: reformat all codes using gofmt 1.19 (the Go tip)</p>
</li>
<li>
<p>all: replace any usage of ioutil package with <code>os</code> or <code>io</code>
</p>
<div class="paragraph">
<p>Since Go 1.16, the ioutil package has been deprecated.
This changes replace any usage that use functions from ioutil package
with their replacement from package os or package io.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_36_0"><a class="anchor" href="#v0_36_0"></a><a class="link" href="#v0_36_0">share v0.36.0 (2022-04-03)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_36_0_breaking_changes"><a class="anchor" href="#v0_36_0_breaking_changes"></a><a class="link" href="#v0_36_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: update the file mode and/or content on DirWatcher</p>
<div class="paragraph">
<p>Previously, the DirWatcher only forward the NodeState if the file being
watched is deleted or modified.</p>
</div>
<div class="paragraph">
<p>This changes the DirWatcher handle it internally.
If the file is deleted it will be removed from internal MemFS instance.
If the file is updated it will update the mode or content of that file
in the MemFS.</p>
</div>
</li>
<li>
<p>lib/memfs: changes the DirWatcher and Watcher to use channel</p>
<div class="paragraph">
<p>Previously, we use a callback model to propagated changes.
This model has its advantages and disadvantages.</p>
</div>
<div class="paragraph">
<p>The advantages is there is no limit of queue when the changes need to
be propagated to the caller.
The disadvantages of that the watcher needs to wait for callback to
finish before continue processing.
One can run it under goroutine, but it may cause race if the caller does
not handle update properly and it does not guarantee the goroutine
process it in FIFO.
We can see this on the unit test of NewWatcher, we needs to use
sync.WaitGroup to properly check one changes before processing the order.</p>
</div>
<div class="paragraph">
<p>This commit changes the DirWatcher and Watcher to use channel, like
the one in time.Ticker.</p>
</div>
</li>
<li>
<p>all: move the DirWatcher and Watcher types from io to memfs</p>
<div class="paragraph">
<p>There are two reasons why we move them.
First, DirWatcher and Watcher code internally depends on the memfs
package, especially on Node type.
Second, we want to add new Watch method to MemFS which depends on
package io.
If we do that, there will be circular imports.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_new_features"><a class="anchor" href="#_new_features"></a><a class="link" href="#_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: implement handler to check each request to Server Memfs</p>
<div class="paragraph">
<p>The FSHandler define the function to inspect each GET request to Server
MemFS instance.
The node parameter contains the requested file inside the memfs.</p>
</div>
<div class="paragraph">
<p>If the handler return true, server will continue processing the node
(writing the Node content type, body, and so on).</p>
</div>
<div class="paragraph">
<p>If the handler return false, server stop processing the node and return
immediately, which means the function should have already handle writing
the header, status code, and/or body.</p>
</div>
</li>
<li>
<p>lib/memfs: add method to stop the Watch</p>
<div class="paragraph">
<p>The StopWatch method stop watching for update, from calling Watch.</p>
</div>
</li>
<li>
<p>lib/xmlrpc: add method to get boolean field value on Value</p>
<div class="paragraph">
<p>The GetFieldAsBoolean return the struct&#8217;s field value by its key as
bool type.</p>
</div>
</li>
<li>
<p>lib/memfs: add method Watch to MemFS</p>
<div class="paragraph">
<p>The Watch method create and start a DirWatcher that ready to be consumed.</p>
</div>
<div class="paragraph">
<p>This is to simplify watching an existing MemFS instance because the
internal fs inside the DirWatcher is not exported.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_enhancements"><a class="anchor" href="#_enhancements"></a><a class="link" href="#_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: use package mlog for logging</p>
<div class="paragraph">
<p>In case the consumer of lib/http package use mlog for logging, the
log will be written to their predefined writers.</p>
</div>
<div class="paragraph">
<p>In case they did not use mlog, the log will written to stdout and stderr.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_bug_fixes"><a class="anchor" href="#_bug_fixes"></a><a class="link" href="#_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: check for possible nil on Get</p>
<div class="paragraph">
<p>In case the instance of memfs is set to nil (for example, the root
directory being watched is deleted on DirWatcher), the Get method will
cause panic after the next update on content of root directory.</p>
</div>
</li>
<li>
<p>lib/xmlrpc: use %v to convert non-string type on GetFieldAsString</p>
<div class="paragraph">
<p>Previously, if GetFieldAsString is called and the struct field type is
not string, it will return "%s(&lt;type&gt;=&lt;value&gt;)" instead of the value
in string.</p>
</div>
<div class="paragraph">
<p>This commit fix this issue by using %v to convert non-string type.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_chores"><a class="anchor" href="#_chores"></a><a class="link" href="#_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: differentiate prefix on MemFS&#8217;s Update and Node&#8217;s Update</p>
</li>
<li>
<p>email/dkim: remove amazonses.com domain from test cases</p>
<div class="paragraph">
<p>The domain now return invalid public key record, so we removed them
to make the test passed for now.</p>
</div>
</li>
<li>
<p>lib/memfs: move the test for NewWatcher and DirWatcher as example</p>
<div class="paragraph">
<p>With this we do one thing (write testing) and output two things (testing
the code and give an example for code).</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_35_0"><a class="anchor" href="#v0_35_0"></a><a class="link" href="#v0_35_0">share v0.35.0 (2022-03-04)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_35_0_breaking_changes"><a class="anchor" href="#v0_35_0_breaking_changes"></a><a class="link" href="#v0_35_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/email: change the Header and Body fields on Message to non-pointer.</p>
<div class="paragraph">
<p>The idea is to minimize GC pressure on system with many messages,
minimize checking for nil value, and make an empty Message ready to use
without any initialization.</p>
</div>
</li>
<li>
<p>lib/smtp: refactoring NewClient to use struct instead of parameters.</p>
<div class="paragraph">
<p>Previously, to create new client one must pass three parameters to
NewClient function: localName, remoteURL, and insecure.
If we want to add another parameters in the future, it will cause the
function signature changes.</p>
</div>
<div class="paragraph">
<p>This changes simplify creating NewClient by passing single struct
with new parameters: AuthUser, AuthPass, and AuthMechanism.
If both AuthUser and AuthPass is not empty, the NewClient will
authenticate the connection, minimize number of step on the caller.</p>
</div>
</li>
<li>
<p>lib/smtp: rename Mechanism to SaslMechanism.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_new_features"><a class="anchor" href="#v0_35_0_new_features"></a><a class="link" href="#v0_35_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>cmd/sendemail: command line interface to send an email.</p>
<div class="paragraph">
<p>The sendemail command is proof of concept on how to use lib/email and
lib/smtp to write and send email through SMTP.</p>
</div>
</li>
<li>
<p>cmd/xtrk: command line interface to uncompress and/or un-archive file.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>xtrk accept single file to uncompress and/or archived into a directory
output dir".
If directory output "dir" is not defined, it will be set to current
directory.</p>
</div>
<div class="paragraph">
<p>The compression and archive format is detected automatically based on the
following file input extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>.bz2: decompress using bzip2.</p>
</li>
<li>
<p>.gz: decompress using gzip.</p>
</li>
<li>
<p>.tar: unarchive using tar.</p>
</li>
<li>
<p>.zip: unarchive using zip.</p>
</li>
<li>
<p>.tar.bz2: decompress using bzip2 and unarchive using tar.</p>
</li>
<li>
<p>.tar.gz: decompresss using gzip and unarchive using tar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The input file will be removed on success.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_enhancements"><a class="anchor" href="#v0_35_0_enhancements"></a><a class="link" href="#v0_35_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/dns: increase the default UDP packet size to 1232.</p>
<div class="paragraph">
<p>The value is based on recommendation by <a href="https://dnsflagday.net/2020/" class="bare">https://dnsflagday.net/2020/</a>
to prevent IP fragmentation when supporting EDNS message.</p>
</div>
</li>
<li>
<p>lib/memfs: export the Remount method.</p>
<div class="paragraph">
<p>The Remount method reset the memfs instance to force rescanning
the files again from file system.</p>
</div>
</li>
<li>
<p>lib/email: set the Date and Message-ID on Message Pack.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Calling Pack now set the Date header if its not exist, using the local
time;  and the message-id header if its not exist using the following
format:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>&lt;epoch&gt;.&lt;random-8-chars&gt;@&lt;local-hostname&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The random-8-chars is Seed-ed from Epoch(), so does the boundary.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: make Message Pack works with single text or HTML part.</p>
<div class="paragraph">
<p>Previously, the Pack method generate multipart/alternative message only.</p>
</div>
<div class="paragraph">
<p>Since the Message now can set the body text and HTML, without using
NewMultipart, the Pack method need to be able to accommodate this.</p>
</div>
</li>
<li>
<p>lib/email: add methods to modify Message.</p>
<div class="paragraph">
<p>Previously, a Message can be created only using NewMultipart, which
generate message with text and HTML.</p>
</div>
<div class="paragraph">
<p>This changes add methods to compose a Message: AddCC, AddTo, SetBodyHtml,
SetBodyText, SetCC, SetFrom, SetSubject, and SetTo.</p>
</div>
</li>
<li>
<p>lib/email: set the header Date field on NewMultipart.</p>
<div class="paragraph">
<p>The Date field value is set to current time on the system that
generated the message.</p>
</div>
<div class="paragraph">
<p>The date format is set to "Mon, 2 Jan 2006 15:04:05 -0700" according
to RFC 5322 section 3.3.</p>
</div>
</li>
<li>
<p>lib/smtp: add status codes from RFC 4954.</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The following status codes are added,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>432: StatusPasswordTransitionNeeded, from section 4.7.12.</p>
</li>
<li>
<p>454: StatusTemporaryAuthFailure, from section 4.7.0.</p>
</li>
<li>
<p>534: StatusAuthMechanismTooWeak, from section 5.7.9.</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/mlog: make the Outf method always add new line at the end.</p>
<div class="paragraph">
<p>One of common mistakes when using logging library is to put the new line
"n" at the end of format string, which cause delayed output written
to Stdout (the OS wait for "n" as signal for printing).</p>
</div>
<div class="paragraph">
<p>This changes check new line to every call of Outf method and add it if
its not exist.</p>
</div>
<div class="paragraph">
<p>If the caller need to call Outf multiple times before ending it with
new line, they should handle it manually by storing into temporary
buffer first and call Outf at the end.</p>
</div>
</li>
<li>
<p>lib/memfs: add option CommentHeader to EmbedOptions.</p>
<div class="paragraph">
<p>The CommentHeader option allow user to define custom header to the Go
generated file.
The string value is not checked, whether it&#8217;s a comment or not, it
will rendered as is.</p>
</div>
</li>
<li>
<p>lib/ini: make the Marshal on map field sorted by keys</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Given the following struct,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>type ADT struct {
	Amap map[string]string `ini:"section:sub"`
}</pre>
</div>
</div>
<div class="paragraph">
<p>and ini text,</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[test "map"]
c = 3
b = 2
a = 1</pre>
</div>
</div>
<div class="paragraph">
<p>Unmarshal-ing the text into ADT and then Marshal-ing it again will
result in unpredictable keys order.</p>
</div>
<div class="paragraph">
<p>This changes fix this issue by sorting the keys on ADT.Amap on
Marshal-ing, to make the written output predictable.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_bug_fixes"><a class="anchor" href="#v0_35_0_bug_fixes"></a><a class="link" href="#v0_35_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/io: fix DirWatcher not removing old files on rename.</p>
<div class="paragraph">
<p>Previously, if a sub-directory being watched by DirWatcher is renamed,
the old directory does not get removed from field dirs.</p>
</div>
<div class="paragraph">
<p>This commit fix this issue by deleting the sub directory on unmpSubdirs.</p>
</div>
<div class="paragraph">
<p>While at it, guard any read/write to dirs field with mutex to prevent
data race.</p>
</div>
</li>
<li>
<p>lib/dns: check for possible index out of range when unpacking RR.</p>
<div class="paragraph">
<p>There is a possibility that record data (rdata) length inside the
packet is greater than length of packet itself.  Some of the reasons are
corrupted packet from server or packet poisoning (attacking the DNS
server by sending invalid packet).</p>
</div>
<div class="paragraph">
<p>This changes fix this issue by checking the index and rdata length with
the length of packet before consuming the rdata itself.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_35_0_chores"><a class="anchor" href="#v0_35_0_chores"></a><a class="link" href="#v0_35_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/smtp: provide an example of how to create MailTx from email package.</p>
<div class="paragraph">
<p>If one read the current documentation on how to use the Client.SendTx,
there is a missing link on how to create and populate MailTx.</p>
</div>
<div class="paragraph">
<p>This changes provide the example using the email package to generate
the MailTx Data.</p>
</div>
</li>
<li>
<p>lib/mlog: change default mlog instance to non-pointer.</p>
<div class="paragraph">
<p>Since the default mlog instance is a global variable, using non-pointer
give advantages on minimize GC pressure.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_34_0"><a class="anchor" href="#v0_34_0"></a><a class="link" href="#v0_34_0">share v0.34.0 (2022-02-05)</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="v0_34_0_breaking_changes"><a class="anchor" href="#v0_34_0_breaking_changes"></a><a class="link" href="#v0_34_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/sql: make the table migration customizable</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>In the method Migrate() we add parameter "tableMigration" which define
the name of table where the state of migration will be saved.</p>
</div>
<div class="paragraph">
<p>If its empty default to "_migration".</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_new_features"><a class="anchor" href="#v0_34_0_new_features"></a><a class="link" href="#v0_34_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/os: implement function to Extract compressed and/or archived file</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The Extract function uncompress and/or unarchive file from fileInput
into directory defined by dirOutput.
This is the high level API that combine standard archive/zip, archive/tar,
compress/bzip2, and/or compress/gzip.</p>
</div>
<div class="paragraph">
<p>The compression and archive format is detected automatically based on
the following fileInput extension:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>.bz2: decompress using compress/bzip2.</p>
</li>
<li>
<p>.gz: decompress using compress/gzip.</p>
</li>
<li>
<p>.tar: unarchive using archive/tar.</p>
</li>
<li>
<p>.zip: unarchive using archive/zip.</p>
</li>
<li>
<p>.tar.bz2: decompress using compress/bzip2 and unarchive using
archive/tar.</p>
</li>
<li>
<p>.tar.gz: decompress using compress/gzip and unarchive using
archive/tar.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The output directory, dirOutput, where the decompressed and/or unarchived
file stored. will be created if not exist.
If its empty, it will set to current directory.</p>
</div>
<div class="paragraph">
<p>On success, the compressed and/or archived file will be removed from the
file system.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: implement method Download() on Client</p>
<div class="paragraph">
<p>The Download method get a resource from remote server and write it into
DownloadRequest.Output (a io.Writer).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_enhancements"><a class="anchor" href="#v0_34_0_enhancements"></a><a class="link" href="#v0_34_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/websocket: return error if parameter is empty on RegisterTextHandler</p>
<div class="paragraph">
<p>Previously, the RegisterTextHandler method return nil if method, target,
or handler parameter is not set.
This may cause confusion and hard to debug handler when no connection receive
but the RegisterTextHandler does not have any error.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_34_0_chores"><a class="anchor" href="#v0_34_0_chores"></a><a class="link" href="#v0_34_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: change the test port for testing HTTP server</p>
<div class="paragraph">
<p>Previously, the test port for HTTP server is set to 8080 and may conflict
with any service that running on the local (due to common use of 8080).</p>
</div>
<div class="paragraph">
<p>This changes it to 14832 and we make the full server address stored
as global variable so any tests can references it.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="v0_33_0"><a class="anchor" href="#v0_33_0"></a><a class="link" href="#v0_33_0">share v0.33.0 (2022-01-09)</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Happy New Year!</p>
</div>
<div class="paragraph">
<p>Three years has passed since the first release of this multi-libraries (or Go
module), and we have released at least 33 new features with several bugs here
and there.</p>
</div>
<div class="paragraph">
<p>For anyone who use this module, I hope it help you, as the module name
intended "share", and sorry if its too many breaking changes.</p>
</div>
<div class="paragraph">
<p>Live long and prosper!
See you again next year.</p>
</div>
<div class="sect2">
<h3 id="v0_33_0_new_features"><a class="anchor" href="#v0_33_0_new_features"></a><a class="link" href="#v0_33_0_new_features">New features</a></h3>
<div class="ulist">
<ul>
<li>
<p>cmd/gofilemode: new command to decode the Go file mode</p>
<div class="paragraph">
<p>The Go has their own file mode that works across all operating system.
The file mode is represented by uint64, the command line will convert it
to fs.FileMode and print each possible flag on it including the
permission.</p>
</div>
</li>
<li>
<p>lib/sql: make the TruncateTable run with cascade and restart identity</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>On table that contains foreign key, truncate without cascade may cause
the method fail.</p>
</div>
<div class="paragraph">
<p>Also, since TruncateTable is, and should be only, used on testing, any
identity columns, for example serial, should be reset back to its initial
value. On PostgreSQL this means the truncate table is with
"RESTART IDENTITY".</p>
</div>
</div>
</div>
</li>
<li>
<p>cmd/epoch: command line to print and parse Unix timestamp</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Program epoch print the current time (Unix seconds, milliseconds,
nanoseconds, local time, and UTC time) or the time based on the epoch on
first parameter.
Usage,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>epoch &lt;unix-seconds|unix-milliseconds|unix-nanoseconds&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Without a parameter, it will print the current time.
With single parameter, it will print the time based on that epoch.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_breaking_changes"><a class="anchor" href="#v0_33_0_breaking_changes"></a><a class="link" href="#v0_33_0_breaking_changes">Breaking changes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/http: refactoring NewClient to accept single struct</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Previously, the NewClient function accept three parameters: serverURL,
http.Header, and insecure.  If we want to add another parameter,
for example timeout it will cause changes on the function signature.</p>
</div>
<div class="paragraph">
<p>To prevent this changes in the future, we change it now. The NewClient
now accept single struct.</p>
</div>
<div class="paragraph">
<p>While at it, we add option to set Timeout.</p>
</div>
<div class="paragraph">
<p>The Timeout affect the http Transport Timeout and TLSHandshakeTimeout.
The field is optional, if not set it will set to 10 seconds.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: remove field memfs.Options in ServerOptions</p>
<div class="paragraph">
<p>This options is duplicate with Memfs.Opts.</p>
</div>
</li>
<li>
<p>lib/websocket: add "ok" return value on ClientManager Context</p>
<div class="paragraph">
<p>The ok return value will be true if the context exist or false otherwise.</p>
</div>
</li>
<li>
<p>lib/memfs: remove field ContentEncoding from EmbedOptions and Node</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The original idea for option ContentEncoding in EmbedOptions and Node
is to save spaces, compressing the content on disk on embedding and
doing transport, when the MemFS instance is used to serve the (embedded)
contents of file system.</p>
</div>
<div class="paragraph">
<p>This option turns out break the HTTP content negotiation [1] of
accept-encoding header, if the HTTP server does not handle it properly,
which default Go HTTP server does not.</p>
</div>
<div class="paragraph">
<p>In order to prevent this issue in the future, for anyone who use the
memfs for serving static HTTP contents, we remove the options and store
the embedded content as is and let the HTTP server handle how the
compression by itself.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: refacforing ParseMailbox</p>
<div class="paragraph">
<p>This commit changes the signature of ParseMailbox by returning no error.</p>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>[1] <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation" class="bare">https://developer.mozilla.org/en-US/docs/Web/HTTP/Content_negotiation</a></p>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_bug_fixes"><a class="anchor" href="#v0_33_0_bug_fixes"></a><a class="link" href="#v0_33_0_bug_fixes">Bug fixes</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/memfs: skip mount if the Root node has been initialized</p>
</li>
<li>
<p>lib/websocket: fix race conditition on handleText</p>
<div class="paragraph">
<p>Instead of accessing the ctx field directly, call the Context() method
to prevent data race.</p>
</div>
</li>
<li>
<p>lib/sql: check for EOF on loadSQL</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>There is probably a regression in Go that cause ioutil.ReadAll return
io.EOF, while it should not, because the documentation said that</p>
</div>
<div class="literalblock">
<div class="content">
<pre>A successful call returns err == nil, not err == EOF.</pre>
</div>
</div>
<div class="paragraph">
<p>But in this, using http.FileSystem, the ioutil.ReadAll now return EOF
and we need to check it to make the migration can run without an error.</p>
</div>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_enhancements"><a class="anchor" href="#v0_33_0_enhancements"></a><a class="link" href="#v0_33_0_enhancements">Enhancements</a></h3>
<div class="ulist">
<ul>
<li>
<p>lib/io: realign all structs</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The struct realign, save the occupied of struct size in the memory,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>DirWatcher: from 184 to 144 bytes (-40 bytes)</p>
</li>
<li>
<p>Reader: from 16 to 8 bytes (-8 bytes)</p>
</li>
<li>
<p>Watcher: from 32 to 24 bytes (-8 bytes)</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/http: realign all structs</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>Changes,
* Client: from 56 to 48 bytes (-8 bytes)
* CORSOptions: from 104 to 88 bytes (-16 bytes)
* Endpoint: from 64 to 32 bytes (-32 bytes)
* EndpointRequest: from 72 to 56 bytes (-16 bytes)
* route: from 56 to 32 bytes (-24 bytes)</p>
</div>
<div class="paragraph">
<p>Other changes is struct on unit tests.</p>
</div>
</div>
</div>
</li>
<li>
<p>lib/memfs: add method Init</p>
<div class="paragraph">
<p>The Init provided to initialize MemFS instance if its Options is set
directly, not through New() function.</p>
</div>
</li>
<li>
<p>lib/memfs: embed the Embed options and GenFuncName</p>
<div class="paragraph">
<p>This is to make the instance of memfs initialize from init is reusable.</p>
</div>
</li>
<li>
<p>lib/memfs: realign struct Node, Options, PathNode, and on unit tests</p>
<div class="openblock">
<div class="content">
<div class="paragraph">
<p>The realign save storage spaces on struct,</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Node: from 240 to 224 bytes (-16 bytes)</p>
</li>
<li>
<p>Options: from 112 to 104 bytes (-8 bytes)</p>
</li>
<li>
<p>PathNode: from 16 to 8 bytes (-8 bytes)</p>
</li>
</ul>
</div>
</div>
</div>
</li>
<li>
<p>lib/email: realign the struct Mailbox</p>
<div class="paragraph">
<p>This changes the storage size from 80 to 72 bytes (-8 bytes).</p>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="v0_33_0_chores"><a class="anchor" href="#v0_33_0_chores"></a><a class="link" href="#v0_33_0_chores">Chores</a></h3>
<div class="ulist">
<ul>
<li>
<p>github/workflows: remove step to get dependencies</p>
<div class="paragraph">
<p>The Go module should handle the dependencies automatically.</p>
</div>
</li>
<li>
<p>github/workflows: set go version to 1.17.6</p>
</li>
<li>
<p>lib/email: convert the unit test for ParseMailbox to examples</p>
<div class="paragraph">
<p>Since the ParseMailbox is public we can provide an examples and test
at the same times.</p>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-07-03 14:36:51 +0700
</div>
</div>
			</div>
			
		</div>
		

		<div class="footer">
			Powered by <a
				href="https://git.sr.ht/~shulhan/ciigo"
			>
				ciigo
			</a>
		</div>
	</body>
</html>